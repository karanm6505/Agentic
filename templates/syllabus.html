{% extends "base.html" %}

{% block title %}{{ title }} - Syllabus{% endblock %}

{% block content %}
    <div class="syllabus-detail-container">
        <div class="syllabus-header">
            <div class="container">
                <div class="breadcrumb">
                    <a href="{{ url_for('index') }}"><i class="fas fa-home"></i> Home</a>
                    <i class="fas fa-chevron-right"></i>
                    <span>{{ title }}</span>
                </div>
                <h1 class="syllabus-title">
                    <i class="fas fa-file-alt"></i>
                    {{ title }}
                </h1>
                <div class="syllabus-actions">
                    <button class="action-btn" onclick="toggleTOC()">
                        <i class="fas fa-list"></i> Table of Contents
                    </button>
                    <button class="action-btn" onclick="printSyllabus()">
                        <i class="fas fa-print"></i> Print/Save as PDF
                    </button>
                </div>
            </div>
        </div>
        
        <div class="syllabus-body">
            <div class="table-of-contents" id="toc" style="display: none;">
                <h3><i class="fas fa-list"></i> Table of Contents</h3>
                <ul id="toc-list"></ul>
            </div>
            
            <div class="syllabus-content-wrapper">
                <div class="syllabus-content" id="syllabus-content">
                    {{ content | safe }}
                </div>
            </div>
        </div>
        
        <div class="syllabus-footer">
            <div class="container">
                <a href="{{ url_for('index') }}" class="back-button">
                    <i class="fas fa-arrow-left"></i>
                    Back to Home
                </a>
            </div>
        </div>
    </div>

    <!-- Reading Progress Indicator -->
    <div class="reading-progress" id="reading-progress"></div>

    <script>
        // Generate Table of Contents with improved styling
        function generateTOC() {
            const content = document.getElementById('syllabus-content');
            const headings = content.querySelectorAll('h1, h2, h3, h4');
            const tocList = document.getElementById('toc-list');
            
            tocList.innerHTML = '';
            
            headings.forEach((heading, index) => {
                const id = 'heading-' + index;
                heading.id = id;
                
                const li = document.createElement('li');
                li.className = 'toc-item toc-' + heading.tagName.toLowerCase();
                
                const a = document.createElement('a');
                a.href = '#' + id;
                a.textContent = heading.textContent;
                a.onclick = function(e) {
                    e.preventDefault();
                    document.getElementById(id).scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                };
                
                li.appendChild(a);
                tocList.appendChild(li);
            });
        }
        
        // Reading Progress Indicator
        function updateReadingProgress() {
            const content = document.getElementById('syllabus-content');
            const progressBar = document.getElementById('reading-progress');
            
            const contentHeight = content.scrollHeight;
            const windowHeight = window.innerHeight;
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            const scrollPercent = (scrollTop / (contentHeight - windowHeight)) * 100;
            const clampedPercent = Math.min(100, Math.max(0, scrollPercent));
            
            progressBar.style.width = clampedPercent + '%';
        }
        
        function toggleTOC() {
            const toc = document.getElementById('toc');
            const button = event.target.closest('.action-btn');
            const syllabusBody = document.querySelector('.syllabus-body');
            
            if (toc.style.display === 'none') {
                toc.style.display = 'block';
                button.classList.add('active');
                syllabusBody.classList.remove('toc-hidden');
                generateTOC();
            } else {
                toc.style.display = 'none';
                button.classList.remove('active');
                syllabusBody.classList.add('toc-hidden');
            }
        }
        
        function printSyllabus() {
            // Simple and clean print function
            const content = document.getElementById('syllabus-content');
            const title = document.querySelector('.syllabus-title').textContent.trim();
            const originalTitle = document.title;
            
            // Set document title for print/PDF
            document.title = title + ' - Course Syllabus';
            content.setAttribute('data-title', title);
            
            // Trigger print dialog
            window.print();
            
            // Restore original title
            setTimeout(() => {
                document.title = originalTitle;
            }, 500);
        }
        
        // Smooth scrolling for anchor links
        function smoothScrollToAnchor() {
            const links = document.querySelectorAll('a[href^="#"]');
            links.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
        }
        
        // Add keyboard shortcuts
        function addKeyboardShortcuts() {
            // Keyboard shortcuts have been removed for cleaner user experience
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize with TOC hidden and content full-width
            const syllabusBody = document.querySelector('.syllabus-body');
            syllabusBody.classList.add('toc-hidden');
            
            generateTOC();
            updateReadingProgress();
            smoothScrollToAnchor();
            
            // Set document title for print
            const content = document.getElementById('syllabus-content');
            const title = document.querySelector('.syllabus-title').textContent.trim();
            content.setAttribute('data-title', title);
            
            // Update reading progress on scroll
            window.addEventListener('scroll', updateReadingProgress);
            window.addEventListener('resize', updateReadingProgress);
            
            // Add print event listener to optimize for PDF
            window.addEventListener('beforeprint', function() {
                // Ensure all content is visible for printing
                const toc = document.getElementById('toc');
                if (toc.style.display === 'block') {
                    toc.style.display = 'none';
                }
            });
        });
    </script>
{% endblock %} 