{% extends "base.html" %}

{% block title %}{{ title }} - Syllabus{% endblock %}

{% block content %}
    <div class="syllabus-detail-container">
        <div class="syllabus-header">
            <div class="breadcrumb">
                <a href="{{ url_for('index') }}"><i class="fas fa-home"></i> Home</a>
                <i class="fas fa-chevron-right"></i>
                <span>{{ title }}</span>
            </div>
            <h1 class="syllabus-title">
                <i class="fas fa-file-alt"></i>
                {{ title }}
            </h1>
            <div class="syllabus-actions">
                <button class="action-btn" onclick="toggleTOC()">
                    <i class="fas fa-list"></i> Table of Contents
                </button>
                <button class="action-btn" onclick="window.print()">
                    <i class="fas fa-print"></i> Print
                </button>
                <button class="action-btn" onclick="toggleReadingMode()">
                    <i class="fas fa-eye"></i> Reading Mode
                </button>
            </div>
        </div>
        
        <div class="syllabus-body">
            <div class="table-of-contents" id="toc" style="display: none;">
                <h3><i class="fas fa-list"></i> Table of Contents</h3>
                <ul id="toc-list"></ul>
            </div>
            
            <div class="syllabus-content-wrapper">
                <div class="syllabus-content" id="syllabus-content">
                    {{ content | safe }}
                </div>
            </div>
        </div>
        
        <div class="syllabus-footer">
            <a href="{{ url_for('index') }}" class="back-button">
                <i class="fas fa-arrow-left"></i>
                Back to Home
            </a>
        </div>
    </div>

    <!-- Reading Progress Indicator -->
    <div class="reading-progress" id="reading-progress"></div>

    <script>
        // Generate Table of Contents with improved styling
        function generateTOC() {
            const content = document.getElementById('syllabus-content');
            const headings = content.querySelectorAll('h1, h2, h3, h4');
            const tocList = document.getElementById('toc-list');
            
            tocList.innerHTML = '';
            
            headings.forEach((heading, index) => {
                const id = 'heading-' + index;
                heading.id = id;
                
                const li = document.createElement('li');
                li.className = 'toc-item toc-' + heading.tagName.toLowerCase();
                
                const a = document.createElement('a');
                a.href = '#' + id;
                a.textContent = heading.textContent;
                a.onclick = function(e) {
                    e.preventDefault();
                    document.getElementById(id).scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                };
                
                li.appendChild(a);
                tocList.appendChild(li);
            });
        }
        
        // Reading Progress Indicator
        function updateReadingProgress() {
            const content = document.getElementById('syllabus-content');
            const progressBar = document.getElementById('reading-progress');
            
            const contentHeight = content.scrollHeight;
            const windowHeight = window.innerHeight;
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            const scrollPercent = (scrollTop / (contentHeight - windowHeight)) * 100;
            const clampedPercent = Math.min(100, Math.max(0, scrollPercent));
            
            progressBar.style.width = clampedPercent + '%';
        }
        
        function toggleTOC() {
            const toc = document.getElementById('toc');
            const button = event.target.closest('.action-btn');
            
            if (toc.style.display === 'none') {
                toc.style.display = 'block';
                button.classList.add('active');
                generateTOC();
            } else {
                toc.style.display = 'none';
                button.classList.remove('active');
            }
        }
        
        function toggleReadingMode() {
            const body = document.body;
            const button = event.target.closest('.action-btn');
            
            body.classList.toggle('reading-mode');
            button.classList.toggle('active');
            
            // Update button text
            const icon = button.querySelector('i');
            if (body.classList.contains('reading-mode')) {
                icon.className = 'fas fa-eye-slash';
                button.innerHTML = '<i class="fas fa-eye-slash"></i> Exit Reading Mode';
            } else {
                icon.className = 'fas fa-eye';
                button.innerHTML = '<i class="fas fa-eye"></i> Reading Mode';
            }
        }
        
        // Smooth scrolling for anchor links
        function smoothScrollToAnchor() {
            const links = document.querySelectorAll('a[href^="#"]');
            links.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
        }
        
        // Add keyboard shortcuts
        function addKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                // Press 'T' to toggle TOC
                if (e.key === 't' || e.key === 'T') {
                    if (!e.target.matches('input, textarea')) {
                        e.preventDefault();
                        toggleTOC();
                    }
                }
                
                // Press 'R' to toggle reading mode
                if (e.key === 'r' || e.key === 'R') {
                    if (!e.target.matches('input, textarea')) {
                        e.preventDefault();
                        toggleReadingMode();
                    }
                }
                
                // Press 'P' to print
                if (e.key === 'p' || e.key === 'P') {
                    if (!e.target.matches('input, textarea')) {
                        e.preventDefault();
                        window.print();
                    }
                }
            });
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            generateTOC();
            updateReadingProgress();
            smoothScrollToAnchor();
            addKeyboardShortcuts();
            
            // Update reading progress on scroll
            window.addEventListener('scroll', updateReadingProgress);
            window.addEventListener('resize', updateReadingProgress);
        });
    </script>
{% endblock %} 